<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Load Functions from Shared Libraries - JoeChu</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="JoeChu&#039;s Blog"><meta name="msapplication-TileImage" content="/img/expert.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="JoeChu&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Loading the partial shared library can be beneficial for two reasons:  Original shared library can be very large sometimes(100+ Mb). Original shared library is not accessible until runtime(OEM specifi"><meta property="og:type" content="blog"><meta property="og:title" content="Load Functions from Shared Libraries"><meta property="og:url" content="http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/"><meta property="og:site_name" content="JoeChu"><meta property="og:description" content="Loading the partial shared library can be beneficial for two reasons:  Original shared library can be very large sometimes(100+ Mb). Original shared library is not accessible until runtime(OEM specifi"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://jchuzc.github.io/img/og_image.png"><meta property="article:published_time" content="2024-09-08T21:04:36.000Z"><meta property="article:modified_time" content="2025-10-16T04:26:43.475Z"><meta property="article:author" content="Joe Chu"><meta property="article:tag" content="shared library"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://jchuzc.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/"},"headline":"Load Functions from Shared Libraries","image":["http://jchuzc.github.io/img/og_image.png"],"datePublished":"2024-09-08T21:04:36.000Z","dateModified":"2025-10-16T04:26:43.475Z","author":{"@type":"Person","name":"Joe Chu"},"publisher":{"@type":"Organization","name":"JoeChu","logo":{"@type":"ImageObject","url":"http://jchuzc.github.io/img/expert.png"}},"description":"Loading the partial shared library can be beneficial for two reasons:  Original shared library can be very large sometimes(100+ Mb). Original shared library is not accessible until runtime(OEM specifi"}</script><link rel="canonical" href="http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/"><link rel="icon" href="/img/expert.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories/life">Life</a><a class="navbar-item" href="/categories/cpp">C/C++</a><a class="navbar-item" href="/categories/CGV">CG/CV</a><a class="navbar-item" href="/categories/interview">Interview</a><a class="navbar-item" href="/categories/misc">Misc</a><a class="navbar-item" href="/categories/tool">Tool</a><a class="navbar-item" href="/categories/wealth">Wealth</a><a class="navbar-item" href="/categories/resource">Resources</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-09-08T21:04:36.000Z" title="9/8/2024, 2:04:36 PM">2024-09-08</time></span><span class="level-item"> Joe Chu </span><span class="level-item"><a class="link-muted" href="/categories/cpp/">cpp</a></span><span class="level-item">6 minutes read (About 878 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Load Functions from Shared Libraries</h1><div class="content"><p>Loading the partial shared library can be beneficial for two reasons:</p>
<ol>
<li>Original shared library can be very large sometimes(100+ Mb).</li>
<li>Original shared library is not accessible until runtime(OEM specific libraries such OpenCL).</li>
</ol>
<span id="more"></span>

<h1 id="1-Demo"><a href="#1-Demo" class="headerlink" title="1. Demo"></a>1. Demo</h1><p>We will start with a customized demo example to illustrate how to load partial shared library at runtime.</p>
<p>We will generate a simplified math library containing basic algorithmic operations(add, subtract, multiply and divide). <code>test.cpp</code> will load these functions <strong>at runtime</strong>.</p>
<h2 id="1-1-Code"><a href="#1-1-Code" class="headerlink" title="1.1 Code"></a>1.1 Code</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mathOP.cpp</span><br><span class="line">├── mathOP.h</span><br><span class="line">└── test.cpp</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mathOP.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MATH_OPERATIONS_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATH_OPERATIONS_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">add</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">subtract</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">multiply</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">divide</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MATH_OPERATIONS_H</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">add</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">subtract</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">multiply</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">divide</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> a / b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INFINITY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mathOP.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">void</span>* handle = <span class="built_in">dlopen</span>(<span class="string">&quot;./mathOP.so&quot;</span>, RTLD_LAZY);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Cannot open library: &quot;</span> &lt;&lt; <span class="built_in">dlerror</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load the functions</span></span><br><span class="line">    <span class="built_in">double</span> (*add)(<span class="type">double</span>, <span class="type">double</span>) = (<span class="built_in">double</span> (*)(<span class="type">double</span>, <span class="type">double</span>)) <span class="built_in">dlsym</span>(handle, <span class="string">&quot;add&quot;</span>);</span><br><span class="line">    <span class="built_in">double</span> (*subtract)(<span class="type">double</span>, <span class="type">double</span>) = (<span class="built_in">double</span> (*)(<span class="type">double</span>, <span class="type">double</span>)) <span class="built_in">dlsym</span>(handle, <span class="string">&quot;subtract&quot;</span>);</span><br><span class="line">    <span class="built_in">double</span> (*multiply)(<span class="type">double</span>, <span class="type">double</span>) = (<span class="built_in">double</span> (*)(<span class="type">double</span>, <span class="type">double</span>)) <span class="built_in">dlsym</span>(handle, <span class="string">&quot;multiply&quot;</span>);</span><br><span class="line">    <span class="built_in">double</span> (*divide)(<span class="type">double</span>, <span class="type">double</span>) = (<span class="built_in">double</span> (*)(<span class="type">double</span>, <span class="type">double</span>)) <span class="built_in">dlsym</span>(handle, <span class="string">&quot;divide&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!add || !subtract || !multiply || !divide) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Cannot load functions: &quot;</span> &lt;&lt; <span class="built_in">dlerror</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="built_in">dlclose</span>(handle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use the functions</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;5 + 3 = &quot;</span> &lt;&lt; <span class="built_in">add</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;5 - 3 = &quot;</span> &lt;&lt; <span class="built_in">subtract</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;5 * 3 = &quot;</span> &lt;&lt; <span class="built_in">multiply</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;5 / 3 = &quot;</span> &lt;&lt; <span class="built_in">divide</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dlclose</span>(handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-Compile-and-Run"><a href="#1-2-Compile-and-Run" class="headerlink" title="1.2 Compile and Run"></a>1.2 Compile and Run</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -fPIC -shared -o mathOP.so mathOP.cpp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o test test.cpp -ldl</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./test</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">5 + 3 = 8</span><br><span class="line">5 - 3 = 2</span><br><span class="line">5 * 3 = 15</span><br><span class="line">5 / 3 = 1.66667</span><br></pre></td></tr></table></figure>

<h1 id="2-Practice-on-libJpeg"><a href="#2-Practice-on-libJpeg" class="headerlink" title="2. Practice on libJpeg"></a>2. Practice on libJpeg</h1><p>If you’re using a Mac with Apple silicon, you can follow my tutorial step by step to reproduce the results. For other operating systems, like Linux or Windows, the process is generally similar, but you may need to do some research and make a few adjustments.</p>
<p>To install jpeg library:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install libjpeg</span><br></pre></td></tr></table></figure>
<p>You should be able to see the installed location in your terminal message. For example, mine is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">If you need to have jpeg first in your PATH, run:</span><br><span class="line">  echo &#x27;export PATH=&quot;/opt/homebrew/opt/jpeg/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line">For compilers to find jpeg you may need to set:</span><br><span class="line">  export LDFLAGS=&quot;-L/opt/homebrew/opt/jpeg/lib&quot;</span><br><span class="line">  export CPPFLAGS=&quot;-I/opt/homebrew/opt/jpeg/include&quot;</span><br></pre></td></tr></table></figure>

<p>Let’s write a C++ program to read a jpeg format image. In our program, we only load needed functions to read an image.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jpeglib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function pointer types using modern C++ syntax</span></span><br><span class="line"><span class="keyword">using</span> jpeg_std_error_type = <span class="keyword">struct</span> jpeg_error_mgr* (*)(<span class="keyword">struct</span> jpeg_error_mgr* err);</span><br><span class="line"><span class="keyword">using</span> jpeg_CreateDecompress_type = <span class="built_in">void</span> (*)(j_decompress_ptr cinfo, <span class="type">int</span> version, <span class="type">size_t</span> structsize);</span><br><span class="line"><span class="keyword">using</span> jpeg_destroy_decompress_type = <span class="built_in">void</span> (*)(j_decompress_ptr cinfo);</span><br><span class="line"><span class="keyword">using</span> jpeg_read_header_type = <span class="built_in">int</span> (*)(j_decompress_ptr cinfo, boolean require_image);</span><br><span class="line"><span class="keyword">using</span> jpeg_start_decompress_type = <span class="built_in">boolean</span> (*)(j_decompress_ptr cinfo);</span><br><span class="line"><span class="keyword">using</span> jpeg_abort_decompress_type = <span class="built_in">void</span> (*)(j_decompress_ptr cinfo);</span><br><span class="line"><span class="keyword">using</span> jpeg_stdio_src_type = <span class="built_in">void</span> (*)(j_decompress_ptr cinfo, FILE* infile);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &lt;JPEG file&gt;&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open the shared library</span></span><br><span class="line">    <span class="type">void</span>* handle = <span class="built_in">dlopen</span>(<span class="string">&quot;/opt/homebrew/opt/jpeg/lib/libjpeg.dylib&quot;</span>, RTLD_LAZY);</span><br><span class="line">    <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">        <span class="comment">// Try an alternative path if the first one fails</span></span><br><span class="line">        handle = <span class="built_in">dlopen</span>(<span class="string">&quot;./libjpeg.dylib&quot;</span>, RTLD_LAZY);</span><br><span class="line">        <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Cannot open library: &quot;</span> &lt;&lt; <span class="built_in">dlerror</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load the functions</span></span><br><span class="line">    <span class="keyword">auto</span> jpeg_std_error = <span class="built_in">reinterpret_cast</span>&lt;jpeg_std_error_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_std_error&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_CreateDecompress = <span class="built_in">reinterpret_cast</span>&lt;jpeg_CreateDecompress_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_CreateDecompress&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_destroy_decompress = <span class="built_in">reinterpret_cast</span>&lt;jpeg_destroy_decompress_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_destroy_decompress&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_read_header = <span class="built_in">reinterpret_cast</span>&lt;jpeg_read_header_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_read_header&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_start_decompress = <span class="built_in">reinterpret_cast</span>&lt;jpeg_start_decompress_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_start_decompress&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_abort_decompress = <span class="built_in">reinterpret_cast</span>&lt;jpeg_abort_decompress_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_abort_decompress&quot;</span>));</span><br><span class="line">    <span class="keyword">auto</span> jpeg_stdio_src = <span class="built_in">reinterpret_cast</span>&lt;jpeg_stdio_src_type&gt;(<span class="built_in">dlsym</span>(handle, <span class="string">&quot;jpeg_stdio_src&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!jpeg_std_error || !jpeg_CreateDecompress || !jpeg_destroy_decompress || </span><br><span class="line">        !jpeg_read_header || !jpeg_start_decompress || !jpeg_abort_decompress || !jpeg_stdio_src) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Cannot load function: &quot;</span> &lt;&lt; <span class="built_in">dlerror</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">dlclose</span>(handle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open the JPEG file</span></span><br><span class="line">    FILE* infile = <span class="built_in">fopen</span>(argv[<span class="number">1</span>], <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!infile) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Can&#x27;t open &quot;</span> &lt;&lt; argv[<span class="number">1</span>] &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">dlclose</span>(handle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the JPEG decompression object</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">jpeg_decompress_struct</span> cinfo;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">jpeg_error_mgr</span> jerr;</span><br><span class="line"></span><br><span class="line">    cinfo.err = <span class="built_in">jpeg_std_error</span>(&amp;jerr);</span><br><span class="line">    <span class="built_in">jpeg_CreateDecompress</span>(&amp;cinfo, JPEG_LIB_VERSION, <span class="built_in">sizeof</span>(<span class="keyword">struct</span> jpeg_decompress_struct));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Specify the source file</span></span><br><span class="line">    <span class="built_in">jpeg_stdio_src</span>(&amp;cinfo, infile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read the JPEG header</span></span><br><span class="line">    <span class="built_in">jpeg_read_header</span>(&amp;cinfo, TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start decompression</span></span><br><span class="line">    <span class="built_in">jpeg_start_decompress</span>(&amp;cinfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print image information</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Image Width: &quot;</span> &lt;&lt; cinfo.output_width &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Image Height: &quot;</span> &lt;&lt; cinfo.output_height &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Color Components: &quot;</span> &lt;&lt; cinfo.output_components &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Color Space: &quot;</span> &lt;&lt; cinfo.out_color_space &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clean up</span></span><br><span class="line">    <span class="built_in">jpeg_abort_decompress</span>(&amp;cinfo);</span><br><span class="line">    <span class="built_in">jpeg_destroy_decompress</span>(&amp;cinfo);</span><br><span class="line">    <span class="built_in">fclose</span>(infile);</span><br><span class="line">    <span class="built_in">dlclose</span>(handle);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To compile and run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g++ -o test test.cpp -I/opt/homebrew/opt/jpeg/include -std=c++11</span><br><span class="line">./test img.jpg</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">Image Width: 4000</span><br><span class="line">Image Height: 6000</span><br><span class="line">Color Components: 3</span><br><span class="line">Color Space: 2</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>Load Functions from Shared Libraries</p><p><a href="http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/">http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Joe Chu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-09-08</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-10-15</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/shared-library/">shared library</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://chuzcjoe.github.io/" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="chuzcjoe@gmail.com"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cpp/cpp-define-function-pointers/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">C++ Function Pointers</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/life-baby-4months/"><span class="level-item">宝宝四个月</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://jchuzc.github.io/cpp/cpp-load-functions-from-shared-library/';
            this.page.identifier = 'cpp/cpp-load-functions-from-shared-library/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'chuzcjoe-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/me.jpeg" alt="Joe Chu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Joe Chu</p><p class="is-size-6 is-block">I like to keep knowledge and memories visible and readable.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fremont, CA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">247</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">187</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/chuzcjoe" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/joe-chu-1784b3179/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Scholar" href="https://scholar.google.com/citations?user=DCwJ1qcAAAAJ&amp;hl=en"><i class="fab fa-google"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1-Demo"><span class="level-left"><span class="level-item">1</span><span class="level-item">1. Demo</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-1-Code"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">1.1 Code</span></span></a></li><li><a class="level is-mobile" href="#1-2-Compile-and-Run"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">1.2 Compile and Run</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-Practice-on-libJpeg"><span class="level-left"><span class="level-item">2</span><span class="level-item">2. Practice on libJpeg</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CGV/"><span class="level-start"><span class="level-item">CGV</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/categories/cpp/"><span class="level-start"><span class="level-item">cpp</span></span><span class="level-end"><span class="level-item tag">75</span></span></a></li><li><a class="level is-mobile" href="/categories/interview/"><span class="level-start"><span class="level-item">interview</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/life/"><span class="level-start"><span class="level-item">life</span></span><span class="level-end"><span class="level-item tag">99</span></span></a></li><li><a class="level is-mobile" href="/categories/misc/"><span class="level-start"><span class="level-item">misc</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/resource/"><span class="level-start"><span class="level-item">resource</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/tool/"><span class="level-start"><span class="level-item">tool</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/wealth/"><span class="level-start"><span class="level-item">wealth</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a><p class="is-size-7"><span>&copy; 2025 Joe Chu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">uv <span id="busuanzi_value_site_uv">0</span></span><br><span id="busuanzi_container_site_pv">pv <span id="busuanzi_value_site_pv">0</span></span></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>