<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Type Punning and Strict Aliasing Rule - JoeChu</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="JoeChu&#039;s Blog"><meta name="msapplication-TileImage" content="/img/expert.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="JoeChu&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Be aware of type manipulation at low level."><meta property="og:type" content="blog"><meta property="og:title" content="Type Punning and Strict Aliasing Rule"><meta property="og:url" content="http://jchuzc.github.io/cpp/cpp-type-punning/"><meta property="og:site_name" content="JoeChu"><meta property="og:description" content="Be aware of type manipulation at low level."><meta property="og:locale" content="en_US"><meta property="og:image" content="http://jchuzc.github.io/img/og_image.png"><meta property="article:published_time" content="2025-05-13T05:40:46.000Z"><meta property="article:modified_time" content="2025-10-16T04:26:43.478Z"><meta property="article:author" content="Joe Chu"><meta property="article:tag" content="cpp"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://jchuzc.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://jchuzc.github.io/cpp/cpp-type-punning/"},"headline":"Type Punning and Strict Aliasing Rule","image":["http://jchuzc.github.io/img/og_image.png"],"datePublished":"2025-05-13T05:40:46.000Z","dateModified":"2025-10-16T04:26:43.478Z","author":{"@type":"Person","name":"Joe Chu"},"publisher":{"@type":"Organization","name":"JoeChu","logo":{"@type":"ImageObject","url":"http://jchuzc.github.io/img/expert.png"}},"description":"Be aware of type manipulation at low level."}</script><link rel="canonical" href="http://jchuzc.github.io/cpp/cpp-type-punning/"><link rel="icon" href="/img/expert.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1486482663275315" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories/life">Life</a><a class="navbar-item" href="/categories/cpp">C/C++</a><a class="navbar-item" href="/categories/CGV">CG/CV</a><a class="navbar-item" href="/categories/interview">Interview</a><a class="navbar-item" href="/categories/misc">Misc</a><a class="navbar-item" href="/categories/tool">Tool</a><a class="navbar-item" href="/categories/wealth">Wealth</a><a class="navbar-item" href="/categories/resource">Resources</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-05-13T05:40:46.000Z" title="5/12/2025, 10:40:46 PM">2025-05-12</time></span><span class="level-item"> Joe Chu </span><span class="level-item"><a class="link-muted" href="/categories/cpp/">cpp</a></span><span class="level-item">10 minutes read (About 1557 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Type Punning and Strict Aliasing Rule</h1><div class="content"><p>Be aware of type manipulation at low level.</p>
<span id="more"></span>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Modern C++ programs are expected to be both correct and fast. When it comes to type manipulation, these two goals can sometimes come into conflict. This is especially true when we engage in “type punning” – the practice of accessing memory through a different type than it was originally defined with.</p>
<p>While type punning can be a powerful technique for certain low-level operations, it interacts with an important concept in the C++ language specification: the strict aliasing rule. Misunderstanding this relationship can lead to subtle bugs, undefined behavior, and optimization barriers.</p>
<p>This article will help you understand:</p>
<ul>
<li>What type punning is and why it’s sometimes necessary</li>
<li>The strict aliasing rule and its implications</li>
<li>Safe approaches to type punning in modern C++</li>
<li>Common pitfalls and how to avoid them</li>
</ul>
<h2 id="Part-1-Understanding-Type-Punning"><a href="#Part-1-Understanding-Type-Punning" class="headerlink" title="Part 1: Understanding Type Punning"></a>Part 1: Understanding Type Punning</h2><h3 id="What-is-Type-Punning"><a href="#What-is-Type-Punning" class="headerlink" title="What is Type Punning?"></a>What is Type Punning?</h3><p>Type punning is a programming technique that involves treating data of one type as if it were another type. The term “punning” comes from the linguistic concept of using a word in a way that exploits multiple meanings – similarly, in programming, we’re using a memory location in a way that exploits multiple interpretations of its contents.</p>
<p>Consider a simple example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f = <span class="number">3.14f</span>;</span><br><span class="line"><span class="type">uint32_t</span> bits = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint32_t</span>*&gt;(&amp;f);  <span class="comment">// Type punning</span></span><br></pre></td></tr></table></figure>

<p>Here, we’re taking a <code>float</code> value and accessing its raw memory representation as a <code>uint32_t</code>. This allows us to see the IEEE 754 bit pattern that represents the floating-point value.</p>
<h3 id="Why-Use-Type-Punning"><a href="#Why-Use-Type-Punning" class="headerlink" title="Why Use Type Punning?"></a>Why Use Type Punning?</h3><p>There are several legitimate use cases for type punning:</p>
<ol>
<li><strong>Bit-level manipulation</strong>: Examining or modifying the binary representation of values</li>
<li><strong>Performance optimization</strong>: In certain scenarios, reinterpreting data can be faster than conversion</li>
<li><strong>Serialization&#x2F;deserialization</strong>: Converting between in-memory data structures and standardized formats</li>
<li><strong>Memory-mapped hardware interfaces</strong>: Interacting with memory-mapped registers or specialized hardware</li>
<li><strong>Implementation of specialized algorithms</strong>: Such as the famous “fast inverse square root” algorithm</li>
</ol>
<h3 id="A-Historical-Example-Fast-Inverse-Square-Root"><a href="#A-Historical-Example-Fast-Inverse-Square-Root" class="headerlink" title="A Historical Example: Fast Inverse Square Root"></a>A Historical Example: Fast Inverse Square Root</h3><p>One of the most well-known examples of type punning is the “Fast Inverse Square Root” algorithm from the Quake III Arena game engine:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">float</span> <span class="title">Q_rsqrt</span><span class="params">(<span class="type">float</span> number)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">float</span> x2, y;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> threehalfs = <span class="number">1.5F</span>;</span><br><span class="line"></span><br><span class="line">    x2 = number * <span class="number">0.5F</span>;</span><br><span class="line">    y = number;</span><br><span class="line">    i = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">long</span>*&gt;(&amp;y);  <span class="comment">// Type punning: float bits as long</span></span><br><span class="line">    i = <span class="number">0x5f3759df</span> - (i &gt;&gt; <span class="number">1</span>);         <span class="comment">// The magic happens here</span></span><br><span class="line">    y = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">float</span>*&gt;(&amp;i); <span class="comment">// Type punning: long bits as float</span></span><br><span class="line">    y = y * (threehalfs - (x2 * y * y));  <span class="comment">// Newton&#x27;s method iteration</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This ingenious algorithm uses type punning to convert between <code>float</code> and integer types, allowing it to perform a numerical approximation much faster than standard methods of the time.</p>
<h2 id="Part-2-The-Strict-Aliasing-Rule"><a href="#Part-2-The-Strict-Aliasing-Rule" class="headerlink" title="Part 2: The Strict Aliasing Rule"></a>Part 2: The Strict Aliasing Rule</h2><h3 id="What-is-Strict-Aliasing"><a href="#What-is-Strict-Aliasing" class="headerlink" title="What is Strict Aliasing?"></a>What is Strict Aliasing?</h3><p>The strict aliasing rule is a fundamental part of the C and C++ language standards that dictates how pointers of different types can be used to access the same memory location. In essence, the rule states:</p>
<blockquote>
<p>An object shall have its stored value accessed only by an lvalue expression that has one of the following types:</p>
<ul>
<li>The declared type of the object</li>
<li>A type that is the signed or unsigned version of the declared type</li>
<li>A type that is an aggregate or union type that includes one of the aforementioned types among its elements</li>
<li>A character type (<code>char</code>, <code>unsigned char</code>, or <code>std::byte</code>)</li>
</ul>
</blockquote>
<h3 id="Why-Does-Strict-Aliasing-Matter"><a href="#Why-Does-Strict-Aliasing-Matter" class="headerlink" title="Why Does Strict Aliasing Matter?"></a>Why Does Strict Aliasing Matter?</h3><p>The strict aliasing rule exists to enable compiler optimizations. When the compiler can assume that objects of different types don’t refer to the same memory (don’t “alias” each other), it can perform optimizations like:</p>
<ul>
<li>Reordering memory reads and writes</li>
<li>Caching values in registers rather than re-reading from memory</li>
<li>Eliminating seemingly redundant loads and stores</li>
</ul>
<p>These optimizations can significantly improve performance, but they rely on the programmer following the aliasing rules.</p>
<h3 id="The-Consequences-of-Violating-Strict-Aliasing"><a href="#The-Consequences-of-Violating-Strict-Aliasing" class="headerlink" title="The Consequences of Violating Strict Aliasing"></a>The Consequences of Violating Strict Aliasing</h3><p>When you violate the strict aliasing rule, you enter the realm of undefined behavior. The compiler is free to generate code based on assumptions that your illegal aliasing violates, which can lead to:</p>
<ul>
<li>Unexpected program behavior</li>
<li>Different results with different optimization levels</li>
<li>Bugs that only appear in release builds</li>
<li>Code that works on one compiler but fails on another</li>
</ul>
<h2 id="Part-3-Type-Punning-Methods-and-Safety"><a href="#Part-3-Type-Punning-Methods-and-Safety" class="headerlink" title="Part 3: Type Punning Methods and Safety"></a>Part 3: Type Punning Methods and Safety</h2><p>Let’s examine different approaches to type punning, from the most dangerous to the safest.</p>
<h3 id="Method-1-Direct-Casting-Unsafe"><a href="#Method-1-Direct-Casting-Unsafe" class="headerlink" title="Method 1: Direct Casting (Unsafe)"></a>Method 1: Direct Casting (Unsafe)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f = <span class="number">3.14f</span>;</span><br><span class="line"><span class="type">uint32_t</span> bits = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint32_t</span>*&gt;(&amp;f);  <span class="comment">// DANGEROUS: Violates strict aliasing</span></span><br></pre></td></tr></table></figure>

<p>This approach violates strict aliasing because we’re accessing a <code>float</code> object through a <code>uint32_t</code> pointer. While it might work in practice on many compilers, it’s technically undefined behavior.</p>
<h3 id="Method-2-Using-memcpy-Safe"><a href="#Method-2-Using-memcpy-Safe" class="headerlink" title="Method 2: Using memcpy (Safe)"></a>Method 2: Using <code>memcpy</code> (Safe)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f = <span class="number">3.14f</span>;</span><br><span class="line"><span class="type">uint32_t</span> bits;</span><br><span class="line">std::<span class="built_in">memcpy</span>(&amp;bits, &amp;f, <span class="built_in">sizeof</span>(<span class="type">float</span>));  <span class="comment">// Safe: No aliasing violation</span></span><br></pre></td></tr></table></figure>

<p>This approach is safe because it doesn’t involve accessing the same memory through different typed pointers - it makes a copy instead. The compiler understands <code>memcpy</code> and can often optimize it to be as efficient as direct casting.</p>
<h3 id="Method-3-Using-Unions-Conditionally-Safe"><a href="#Method-3-Using-Unions-Conditionally-Safe" class="headerlink" title="Method 3: Using Unions (Conditionally Safe)"></a>Method 3: Using Unions (Conditionally Safe)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="title class_">FloatBits</span> &#123;</span><br><span class="line">    <span class="type">float</span> f;</span><br><span class="line">    <span class="type">uint32_t</span> bits;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">FloatBits fb;</span><br><span class="line">fb.f = <span class="number">3.14f</span>;</span><br><span class="line"><span class="type">uint32_t</span> bits = fb.bits;  <span class="comment">// Not guaranteed by C++ standard but widely supported</span></span><br></pre></td></tr></table></figure>

<p>The C++ standard historically didn’t guarantee this would work, though C99 explicitly allowed it. In practice, most C++ compilers support it, and C++20 has improved the situation with support for “active union members.”</p>
<h3 id="Method-4-Using-std-bit-cast-C-20-Safe"><a href="#Method-4-Using-std-bit-cast-C-20-Safe" class="headerlink" title="Method 4: Using std::bit_cast (C++20, Safe)"></a>Method 4: Using <code>std::bit_cast</code> (C++20, Safe)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f = <span class="number">3.14f</span>;</span><br><span class="line"><span class="type">uint32_t</span> bits = std::<span class="built_in">bit_cast</span>&lt;<span class="type">uint32_t</span>&gt;(f);  <span class="comment">// Safe and elegant in C++20</span></span><br></pre></td></tr></table></figure>

<p><code>std::bit_cast</code> was introduced in C++20 specifically to provide a safe, well-defined way to perform type punning. It requires that both types have the same size and that the destination type is trivially copyable.</p>
<h2 id="Part-4-Common-Use-Cases-with-Safe-Implementations"><a href="#Part-4-Common-Use-Cases-with-Safe-Implementations" class="headerlink" title="Part 4: Common Use Cases with Safe Implementations"></a>Part 4: Common Use Cases with Safe Implementations</h2><h3 id="Example-1-IEEE-754-Bit-Manipulation"><a href="#Example-1-IEEE-754-Bit-Manipulation" class="headerlink" title="Example 1: IEEE 754 Bit Manipulation"></a>Example 1: IEEE 754 Bit Manipulation</h3><p>Let’s say we want to extract the sign, exponent, and mantissa from a floating-point number:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">IEEE754Float</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> mantissa : <span class="number">23</span>;</span><br><span class="line">    <span class="type">uint32_t</span> exponent : <span class="number">8</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sign : <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inspectFloat</span><span class="params">(<span class="type">float</span> f)</span> </span>&#123;</span><br><span class="line">    IEEE754Float parts;</span><br><span class="line">    std::<span class="built_in">memcpy</span>(&amp;parts, &amp;f, <span class="built_in">sizeof</span>(<span class="type">float</span>));  <span class="comment">// Safe type punning</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Float value: &quot;</span> &lt;&lt; f &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Sign bit: &quot;</span> &lt;&lt; parts.sign &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Exponent: &quot;</span> &lt;&lt; parts.exponent &lt;&lt; <span class="string">&quot; (bias 127: &quot;</span> </span><br><span class="line">              &lt;&lt; (parts.exponent - <span class="number">127</span>) &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Mantissa bits: &quot;</span> &lt;&lt; std::<span class="built_in">bitset</span>&lt;<span class="number">23</span>&gt;(parts.mantissa) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Example-2-Serialization"><a href="#Example-2-Serialization" class="headerlink" title="Example 2: Serialization"></a>Example 2: Serialization</h3><p>When transmitting data over a network or saving to a file, we might need to convert between native types and standardized formats:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Convert a 32-bit integer to network byte order and add to buffer</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addInt32ToBuffer</span><span class="params">(std::vector&lt;<span class="type">uint8_t</span>&gt;&amp; buffer, <span class="type">int32_t</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Convert to network byte order (big endian)</span></span><br><span class="line">    <span class="type">uint32_t</span> networkValue = <span class="built_in">htonl</span>(<span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(value));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Get raw bytes using safe type punning</span></span><br><span class="line">    <span class="type">uint8_t</span> bytes[<span class="number">4</span>];</span><br><span class="line">    std::<span class="built_in">memcpy</span>(bytes, &amp;networkValue, <span class="built_in">sizeof</span>(networkValue));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Add to buffer</span></span><br><span class="line">    buffer.<span class="built_in">insert</span>(buffer.<span class="built_in">end</span>(), bytes, bytes + <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read a 32-bit integer from network byte order</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">readInt32FromBuffer</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* buffer)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> networkValue;</span><br><span class="line">    std::<span class="built_in">memcpy</span>(&amp;networkValue, buffer, <span class="built_in">sizeof</span>(<span class="type">uint32_t</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Convert from network byte order (big endian) to host byte order</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">int32_t</span>&gt;(<span class="built_in">ntohl</span>(networkValue));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Part-5-Compiler-Specific-Considerations"><a href="#Part-5-Compiler-Specific-Considerations" class="headerlink" title="Part 5: Compiler-Specific Considerations"></a>Part 5: Compiler-Specific Considerations</h2><h3 id="The-fno-strict-aliasing-Option"><a href="#The-fno-strict-aliasing-Option" class="headerlink" title="The -fno-strict-aliasing Option"></a>The <code>-fno-strict-aliasing</code> Option</h3><p>GCC and Clang provide a <code>-fno-strict-aliasing</code> compiler flag that disables optimizations based on the strict aliasing rule. While this can make unsafe type punning “work,” it’s generally better to use safe techniques than to disable important optimizations.</p>
<h3 id="attribute-may-alias-in-GCC"><a href="#attribute-may-alias-in-GCC" class="headerlink" title="__attribute__((may_alias)) in GCC"></a><code>__attribute__((may_alias))</code> in GCC</h3><p>GCC provides an attribute that can be used to indicate that a type is allowed to alias other types:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">float</span> __attribute__((may_alias)) alias_float;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">unsafe_but_marked</span><span class="params">(<span class="type">uint32_t</span>* ptr)</span> </span>&#123;</span><br><span class="line">    alias_float* fptr = (alias_float*)ptr;</span><br><span class="line">    *fptr = <span class="number">3.14f</span>;  <span class="comment">// Marked as intentionally violating strict aliasing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Microsoft-Visual-C-Behavior"><a href="#Microsoft-Visual-C-Behavior" class="headerlink" title="Microsoft Visual C++ Behavior"></a>Microsoft Visual C++ Behavior</h3><p>MSVC historically has been more lenient with aliasing violations, sometimes not performing optimizations that would break common type punning code. However, as the compiler evolves, relying on this behavior is risky.</p>
<h2 id="Part-6-Best-Practices"><a href="#Part-6-Best-Practices" class="headerlink" title="Part 6: Best Practices"></a>Part 6: Best Practices</h2><ol>
<li><p><strong>Prefer standard-approved methods:</strong></p>
<ul>
<li>Use <code>std::bit_cast</code> in C++20</li>
<li>Use <code>std::memcpy</code> in earlier versions</li>
</ul>
</li>
<li><p><strong>Document type punning clearly:</strong></p>
<ul>
<li>Comment your code to explain why type punning is necessary</li>
<li>Consider encapsulating punning operations in well-named functions</li>
</ul>
</li>
<li><p><strong>Be aware of alignment requirements:</strong></p>
<ul>
<li>Different types have different alignment requirements</li>
<li>Misaligned access can cause performance penalties or hardware exceptions</li>
</ul>
</li>
<li><p><strong>Consider portability concerns:</strong></p>
<ul>
<li>Endianness differences between platforms</li>
<li>Differences in floating-point representations</li>
<li>Padding and alignment variations</li>
</ul>
</li>
<li><p><strong>Use appropriate compiler flags during development:</strong></p>
<ul>
<li>Enable warnings about strict aliasing violations</li>
<li>Consider using <code>-fstrict-aliasing</code> to catch issues early</li>
</ul>
</li>
</ol>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Type punning is a powerful technique that allows programmers to manipulate data at a low level, but it must be done with care to avoid undefined behavior. The strict aliasing rule exists for good reason – it enables important compiler optimizations that improve performance.</p>
<p>In modern C++, we have safe alternatives to traditional type punning techniques:</p>
<ul>
<li><code>std::bit_cast</code> in C++20</li>
<li><code>std::memcpy</code> in earlier versions</li>
<li>Carefully documented union-based approaches where appropriate</li>
</ul>
<p>By understanding the relationship between type punning and strict aliasing, you can write code that is both correct and efficient, avoiding the subtle bugs that can arise from undefined behavior.</p>
<p>Remember: just because code works doesn’t mean it’s correct. Undefined behavior might appear to work until a compiler update or optimization setting change reveals the latent bug. Stick to well-defined approaches to ensure your code remains reliable for years to come.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Type Punning and Strict Aliasing Rule</p><p><a href="http://jchuzc.github.io/cpp/cpp-type-punning/">http://jchuzc.github.io/cpp/cpp-type-punning/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Joe Chu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2025-05-12</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-10-15</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/cpp/">cpp</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://chuzcjoe.github.io/" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="chuzcjoe@gmail.com"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cpp/cpp-bitfields/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Bitfields</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/life-venardos-circus/"><span class="level-item">Venardos Circus</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://jchuzc.github.io/cpp/cpp-type-punning/';
            this.page.identifier = 'cpp/cpp-type-punning/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'chuzcjoe-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/baby.png" alt="Joe Chu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Joe Chu</p><p class="is-size-6 is-block">I like to keep knowledge and memories visible and readable.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fremont, CA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">247</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">187</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/chuzcjoe" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/joe-chu-1784b3179/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Scholar" href="https://scholar.google.com/citations?user=DCwJ1qcAAAAJ&amp;hl=en"><i class="fab fa-google"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#Part-1-Understanding-Type-Punning"><span class="level-left"><span class="level-item">2</span><span class="level-item">Part 1: Understanding Type Punning</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#What-is-Type-Punning"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">What is Type Punning?</span></span></a></li><li><a class="level is-mobile" href="#Why-Use-Type-Punning"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Why Use Type Punning?</span></span></a></li><li><a class="level is-mobile" href="#A-Historical-Example-Fast-Inverse-Square-Root"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">A Historical Example: Fast Inverse Square Root</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Part-2-The-Strict-Aliasing-Rule"><span class="level-left"><span class="level-item">3</span><span class="level-item">Part 2: The Strict Aliasing Rule</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#What-is-Strict-Aliasing"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">What is Strict Aliasing?</span></span></a></li><li><a class="level is-mobile" href="#Why-Does-Strict-Aliasing-Matter"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Why Does Strict Aliasing Matter?</span></span></a></li><li><a class="level is-mobile" href="#The-Consequences-of-Violating-Strict-Aliasing"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">The Consequences of Violating Strict Aliasing</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Part-3-Type-Punning-Methods-and-Safety"><span class="level-left"><span class="level-item">4</span><span class="level-item">Part 3: Type Punning Methods and Safety</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Method-1-Direct-Casting-Unsafe"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">Method 1: Direct Casting (Unsafe)</span></span></a></li><li><a class="level is-mobile" href="#Method-2-Using-memcpy-Safe"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Method 2: Using memcpy (Safe)</span></span></a></li><li><a class="level is-mobile" href="#Method-3-Using-Unions-Conditionally-Safe"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">Method 3: Using Unions (Conditionally Safe)</span></span></a></li><li><a class="level is-mobile" href="#Method-4-Using-std-bit-cast-C-20-Safe"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">Method 4: Using std::bit_cast (C++20, Safe)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Part-4-Common-Use-Cases-with-Safe-Implementations"><span class="level-left"><span class="level-item">5</span><span class="level-item">Part 4: Common Use Cases with Safe Implementations</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Example-1-IEEE-754-Bit-Manipulation"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Example 1: IEEE 754 Bit Manipulation</span></span></a></li><li><a class="level is-mobile" href="#Example-2-Serialization"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Example 2: Serialization</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Part-5-Compiler-Specific-Considerations"><span class="level-left"><span class="level-item">6</span><span class="level-item">Part 5: Compiler-Specific Considerations</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#The-fno-strict-aliasing-Option"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">The -fno-strict-aliasing Option</span></span></a></li><li><a class="level is-mobile" href="#attribute-may-alias-in-GCC"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">__attribute__((may_alias)) in GCC</span></span></a></li><li><a class="level is-mobile" href="#Microsoft-Visual-C-Behavior"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">Microsoft Visual C++ Behavior</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Part-6-Best-Practices"><span class="level-left"><span class="level-item">7</span><span class="level-item">Part 6: Best Practices</span></span></a></li><li><a class="level is-mobile" href="#Conclusion"><span class="level-left"><span class="level-item">8</span><span class="level-item">Conclusion</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1486482663275315" data-ad-slot="5727003811" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a><p class="is-size-7"><span>&copy; 2025 Joe Chu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">uv <span id="busuanzi_value_site_uv">0</span></span><br><span id="busuanzi_container_site_pv">pv <span id="busuanzi_value_site_pv">0</span></span></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>