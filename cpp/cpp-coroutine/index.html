<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Coroutine in C++ - JoeChu</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="JoeChu&#039;s Blog"><meta name="msapplication-TileImage" content="/img/expert.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="JoeChu&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Introduced in C++20"><meta property="og:type" content="blog"><meta property="og:title" content="Coroutine in C++"><meta property="og:url" content="http://chuzcjoe.github.io/cpp/cpp-coroutine/"><meta property="og:site_name" content="JoeChu"><meta property="og:description" content="Introduced in C++20"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://chuzcjoe.github.io/cpp/cpp-coroutine/function_coroutine.png"><meta property="og:image" content="http://chuzcjoe.github.io/cpp/cpp-coroutine/statemachinecoroutine.png"><meta property="article:published_time" content="2024-04-08T02:13:57.000Z"><meta property="article:modified_time" content="2025-10-16T04:26:43.472Z"><meta property="article:author" content="Joe Chu"><meta property="article:tag" content="cpp"><meta property="article:tag" content="coroutine"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://chuzcjoe.github.io/cpp/cpp-coroutine/function_coroutine.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://chuzcjoe.github.io/cpp/cpp-coroutine/"},"headline":"Coroutine in C++","image":["http://chuzcjoe.github.io/cpp/cpp-coroutine/function_coroutine.png","http://chuzcjoe.github.io/cpp/cpp-coroutine/statemachinecoroutine.png"],"datePublished":"2024-04-08T02:13:57.000Z","dateModified":"2025-10-16T04:26:43.472Z","author":{"@type":"Person","name":"Joe Chu"},"publisher":{"@type":"Organization","name":"JoeChu","logo":{"@type":"ImageObject","url":"http://chuzcjoe.github.io/img/expert.png"}},"description":"Introduced in C++20"}</script><link rel="canonical" href="http://chuzcjoe.github.io/cpp/cpp-coroutine/"><link rel="icon" href="/img/expert.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1486482663275315" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories/life">Life</a><a class="navbar-item" href="/categories/cpp">C/C++</a><a class="navbar-item" href="/categories/CGV">CG/CV</a><a class="navbar-item" href="/categories/interview">Interview</a><a class="navbar-item" href="/categories/misc">Misc</a><a class="navbar-item" href="/categories/tool">Tool</a><a class="navbar-item" href="/categories/wealth">Wealth</a><a class="navbar-item" href="/categories/resource">Resources</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-lightbulb" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-04-08T02:13:57.000Z" title="4/7/2024, 7:13:57 PM">2024-04-07</time></span><span class="level-item"> Joe Chu </span><span class="level-item"><a class="link-muted" href="/categories/cpp/">cpp</a></span><span class="level-item">13 minutes read (About 1991 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Coroutine in C++</h1><div class="content"><p>Introduced in C++20</p>
<span id="more"></span>

<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ol>
<li>Coroutine Basics</li>
<li>State machine of a coroutine</li>
<li>First coroutine program</li>
<li>Resume a suspending coroutine</li>
<li>Lazy and eager coroutines</li>
<li>Restrictions on couroutines</li>
<li>co_yield</li>
<li>Access coroutine data</li>
<li>co_return</li>
<li>co_await</li>
</ol>
<h1 id="1-Coroutine-Basics"><a href="#1-Coroutine-Basics" class="headerlink" title="1. Coroutine Basics"></a>1. Coroutine Basics</h1><p>Coroutine is a special function that suspends its execution and then resumes later. In C++, coroutines are stackless. They suspend by returning to the caller and the data that is required for later execution is stored on heap. Compared to regular functions, coroutines are suspendable by calling <code>co_yield</code> or <code>co_await</code>. Once the coroutine decides to suspend itself, it gives control back to the caller. This allows the caller to resume executing other instructions and at some point resume the coroutine. Finally, when a coroutine reaches the end of its execution, it will return to the caller by calling <code>co_return</code>.</p>
<p align="center">
    <img src="function_coroutine.png" title="A regular image" width="800px" height="350px">
</p>

<p>Coroutines in C++ do not inherently run on separate threads. They are executed in the same thread as the caller, but they provide a way to suspend and resume execution at certain points, allowing other work to be done in between.</p>
<table>
<thead>
<tr>
<th>keyword</th>
<th>actions</th>
<th>state</th>
</tr>
</thead>
<tbody><tr>
<td>co_yield</td>
<td>output</td>
<td>suspend</td>
</tr>
<tr>
<td>co_await</td>
<td>input</td>
<td>suspend</td>
</tr>
<tr>
<td>co_return</td>
<td>output</td>
<td>end</td>
</tr>
</tbody></table>
<h1 id="2-State-machine-of-a-coroutine"><a href="#2-State-machine-of-a-coroutine" class="headerlink" title="2. State machine of a coroutine"></a>2. State machine of a coroutine</h1><p>A simple diagram shows the state transition of a coroutine.</p>
<p align="center">
    <img src="statemachinecoroutine.png" title="A regular image" width="800px" height="350px">
</p>

<h1 id="3-First-coroutine-program"><a href="#3-First-coroutine-program" class="headerlink" title="3. First coroutine program"></a>3. First coroutine program</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123; <span class="comment">// A wrapper type. This is the return type of the coroutine function&#x27;s prototype</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123; <span class="comment">// the compiler looks for a type with the exact name promise_type inside the return type</span></span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// gets executed before a coroutine starts execution</span></span><br><span class="line">        <span class="function">std::suspend_never <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// gets executed when a coroutine finishes execution</span></span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// this is the first method gets called when the coroutine is called for the first time</span></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 foo\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>; <span class="comment">// suspend</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;2 foo\n&quot;</span>; <span class="comment">// will never execute since coroutine suspends in the above line</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ReturnType r = <span class="built_in">foo</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 foo</span><br></pre></td></tr></table></figure>

<h1 id="4-Resume-a-suspending-coroutine"><a href="#4-Resume-a-suspending-coroutine" class="headerlink" title="4. Resume a suspending coroutine"></a>4. Resume a suspending coroutine</h1><p>Coroutine provides class template <code>coroutine_handle</code> to refer to a coroutine. According to official documentation, it has 3 main specilizations.</p>
<ul>
<li>Primary template, can be created from the promise object of type Promise.</li>
<li>Specialization std::coroutine_handle&lt;void&gt; erases the promise type. It is convertible from other specializations.</li>
<li>Specialization std::coroutine_handle&lt;std::noop_coroutine_promise&gt; refers to no-op coroutines. It cannot be created from a promise object</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;<span class="type">void</span>&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    std::coroutine_handle&lt;<span class="type">void</span>&gt; mHandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 foo\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;2 foo\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ReturnType r = <span class="built_in">foo</span>();</span><br><span class="line">    r.mHandle.<span class="built_in">resume</span>(); <span class="comment">// equivalent to r.mHandle();</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 foo</span><br><span class="line">2 foo</span><br></pre></td></tr></table></figure>

<h1 id="5-Lazy-and-eager-coroutines"><a href="#5-Lazy-and-eager-coroutines" class="headerlink" title="5. Lazy and eager coroutines"></a>5. Lazy and eager coroutines</h1><p>Lazy coroutine</p>
<ul>
<li>Suspends immediately upon intial call.</li>
<li>First line of the coroutine body executes only when resumes.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Eager coroutine</p>
<ul>
<li>Starts immediately upon intial call.</li>
<li>First line of the coroutine body always get executed.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="6-Restrictions-on-couroutines"><a href="#6-Restrictions-on-couroutines" class="headerlink" title="6. Restrictions on couroutines"></a>6. Restrictions on couroutines</h1><p>According to <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/coroutines#:~:text=Coroutines%20cannot%20use,cannot%20be%20coroutines.">cppreference</a>, courotines do not apply to some cases, such as  variadic arguments, plain return statements, or placeholder return types (auto or Concept),<br>consteval functions, constexpr functions, constructors, destructors, and the main function.</p>
<p>Some common scenarios where we can use coroutines.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;<span class="type">void</span>&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    std::coroutine_handle&lt;<span class="type">void</span>&gt; mHandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="comment">// 1. member functions</span></span><br><span class="line">    <span class="function">ReturnType <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. static member functions</span></span><br><span class="line">    <span class="function"><span class="type">static</span> ReturnType <span class="title">staticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;1 staticFunc\n&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;2 staticFunc\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">// 3. pure virtual functions</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ReturnType <span class="title">pure</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line">    <span class="comment">// 4. overriding coroutine</span></span><br><span class="line">    <span class="function">ReturnType <span class="title">pure</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;1 pure\n&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;2 pure\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. lambda expression</span></span><br><span class="line"><span class="keyword">auto</span> lambdaFunc = [](<span class="keyword">auto</span> ... params) -&gt; ReturnType &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 pure\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;2 pure\n&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="7-co-yield"><a href="#7-co-yield" class="headerlink" title="7. co_yield"></a>7. co_yield</h1><p>To use <code>co_yield</code>, <code>promise_type</code> needs to define a method <code>yield_value</code>. After <code>yield_value</code> is called, the coroutine suspends and it gives the control back to the caller. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;mVal = val;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">suspend_always</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>To implement a simple generator with <code>co_yield</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="type">int</span> mVal;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;mVal = val;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">suspend_always</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; mHandle;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mHandle.<span class="built_in">promise</span>().mVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">generator</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, <span class="type">int</span> step = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> val = start; val &lt; end; val+=step) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> gen = <span class="built_in">generator</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">while</span>(!gen.mHandle.<span class="built_in">done</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;val: &quot;</span> &lt;&lt; gen.<span class="built_in">getValue</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        gen.<span class="built_in">mHandle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val: 0</span><br><span class="line">val: 2</span><br><span class="line">val: 4</span><br><span class="line">val: 6</span><br><span class="line">val: 8</span><br></pre></td></tr></table></figure>

<h1 id="8-Access-coroutine-data"><a href="#8-Access-coroutine-data" class="headerlink" title="8. Access coroutine data"></a>8. Access coroutine data</h1><p>Make sure <code>final_suspend()</code> has return type of <code>std::suspend_always</code>, otherwise, the coroutine will not reach its last suspend point.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// make sure final_suspend() is et </span></span><br><span class="line">        </span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>-&gt;val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">double</span> v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ~<span class="built_in">promise_type</span>() &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;~promise_type\n&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = <span class="number">1.23</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">double</span> val = <span class="number">1.23</span>;</span><br><span class="line">    &#125;; <span class="comment">// promise_type</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    <span class="comment">// implicit conversion to std::coroutine_handle&lt;promise_type&gt;</span></span><br><span class="line">    <span class="keyword">operator</span> std::<span class="built_in">coroutine_handle</span>&lt;promise_type&gt;() &#123;<span class="keyword">return</span> mHandle;&#125;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        std::coroutine_handle&lt;promise_type&gt; mHandle;</span><br><span class="line">&#125;; <span class="comment">// ReturnType</span></span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">AccessDataCoroutine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 AccessDataCoroutine\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;2 AccessDataCoroutine\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;3 AccessDataCoroutine\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">caller</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::coroutine_handle&lt;ReturnType::promise_type&gt; h = <span class="built_in">AccessDataCoroutine</span>(); <span class="comment">// ReturnType contains the coroutine handle</span></span><br><span class="line">    ReturnType::promise_type promise = h.<span class="built_in">promise</span>(); <span class="comment">// reference to the promise object.</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!h.<span class="built_in">done</span>()) &#123;</span><br><span class="line">        promise.<span class="built_in">setValue</span>(<span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(i++));</span><br><span class="line">        h.<span class="built_in">resume</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise.<span class="built_in">getValue</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> v = <span class="built_in">caller</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Access data from coroutine: &quot;</span> &lt;&lt; v &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 AccessDataCoroutine</span><br><span class="line">2 AccessDataCoroutine</span><br><span class="line">3 AccessDataCoroutine</span><br><span class="line">~promise_type</span><br><span class="line">Access data from coroutine: 3</span><br></pre></td></tr></table></figure>

<h1 id="9-co-return"><a href="#9-co-return" class="headerlink" title="9. co_return"></a>9. co_return</h1><p><code>co_return</code> must be defined inside <code>promise_type</code> struct, otherwise, the compiler will shows error message.</p>
<p>When the coroutine reaches <code>co_return</code>, it will return to its caller and its state will become end. <code>co_return</code> can either return nothing or value(s).</p>
<ul>
<li>return_void(): In this case, a good practice is to performan some cleanup operations inisde the <code>promise_type</code>, such as free up the allocated memory or reset the values.</li>
<li>return_value(T val): Depending on the return type, we should decide the data type here. This <code>return_value</code> method will get executed by the runtime system when coroutines return with <code>non-empty</code> co_return.</li>
</ul>
<p>It is important to know that these two return methods must be implemented inside the <code>promise_type</code> and these two can not exist at the same time.</p>
<p>return_void example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// make sure final_suspend() is et </span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">return_void</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = <span class="number">1.23</span>;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;perform cleanup operation here\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">double</span> v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ~<span class="built_in">promise_type</span>() &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;~promise_type\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">int</span> val = <span class="number">1.23</span>;</span><br><span class="line">    &#125;; <span class="comment">// promise_type</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    <span class="comment">// implicit conversion</span></span><br><span class="line">    <span class="keyword">operator</span> std::<span class="built_in">coroutine_handle</span>&lt;promise_type&gt;() &#123;<span class="keyword">return</span> mHandle;&#125;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        std::coroutine_handle&lt;promise_type&gt; mHandle;</span><br><span class="line">&#125;; <span class="comment">// ReturnType</span></span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 foo\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;reach co_return\n&quot;</span>;</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">caller</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::coroutine_handle&lt;ReturnType::promise_type&gt; h = <span class="built_in">foo</span>(); <span class="comment">// ReturnType contains the coroutine handle</span></span><br><span class="line">    <span class="keyword">while</span> (!h.<span class="built_in">done</span>()) &#123;</span><br><span class="line">        h.<span class="built_in">resume</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">caller</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 foo</span><br><span class="line">reach co_return</span><br><span class="line">perform cleanup operation here</span><br></pre></td></tr></table></figure>

<p>return_value(T val) example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// make sure final_suspend() is always</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">return_value</span><span class="params">(<span class="type">double</span> v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = v;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;assign v to this-&gt;val\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">double</span> v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ~<span class="built_in">promise_type</span>() &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;~promise_type\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">double</span> val = <span class="number">1.23</span>;</span><br><span class="line">    &#125;; <span class="comment">// promise_type</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ReturnType</span>(std::coroutine_handle&lt;promise_type&gt; handle) : mHandle&#123;handle&#125; &#123;&#125;</span><br><span class="line">    <span class="keyword">operator</span> std::<span class="built_in">coroutine_handle</span>&lt;promise_type&gt;() &#123;<span class="keyword">return</span> mHandle;&#125;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        std::coroutine_handle&lt;promise_type&gt; mHandle;</span><br><span class="line">&#125;; <span class="comment">// ReturnType</span></span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">foo</span><span class="params">(<span class="type">double</span> value)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 foo\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;reach co_return value\n&quot;</span>;</span><br><span class="line">    <span class="keyword">co_return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">caller</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::coroutine_handle&lt;ReturnType::promise_type&gt; h = <span class="built_in">foo</span>(<span class="number">5.0</span>); <span class="comment">// ReturnType contains the coroutine handle</span></span><br><span class="line">    <span class="keyword">while</span> (!h.<span class="built_in">done</span>()) &#123;</span><br><span class="line">        h.<span class="built_in">resume</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;value from coroutine: &quot;</span> &lt;&lt; h.<span class="built_in">promise</span>().<span class="built_in">getValue</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">caller</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 foo</span><br><span class="line">reach co_return value</span><br><span class="line">assign v to this-&gt;val</span><br><span class="line">value from coroutine: 5</span><br></pre></td></tr></table></figure>

<h1 id="10-co-await"><a href="#10-co-await" class="headerlink" title="10. co_await"></a>10. co_await</h1><p><code>co_await</code> suspends a coroutine and returns control back to the caller. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">co_await</span> expr;</span><br></pre></td></tr></table></figure>
<p>As we see in previous examples, the most common use cases are:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_always</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">std::suspend_never</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>suspend_always</code> and <code>suspend_never</code> are both C++ structs that define their own member functions for deciding the coroutine behaviors when <code>co_await</code> is called.</p>
<table>
<thead>
<tr>
<th>member function</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>await_ready</td>
<td>return a bool <br><br>- if true, call await_suspend <br>- if false, return control to caller</td>
</tr>
<tr>
<td>await_suspend</td>
<td>- if return void, return control back to caller<br>- if return bool<br>  1. true - return to caller<br>  2. false - resume coroutine<br>- if returns a coroutine handle for some other coroutine, that handle is resumed (by a call to handle.resume())</td>
</tr>
<tr>
<td>await_resume</td>
<td>does nothing</td>
</tr>
</tbody></table>
<p>We can implement our own suspend class.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SuspendAlways</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">await_ready</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_suspend</span><span class="params">( std::coroutine_handle&lt;&gt; )</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_resume</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>We can try it in our program to see if works like <code>std::suspend_always()</code>;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ReturnType</span> &#123; <span class="comment">// A wrapper type. This is the return type of the coroutine function&#x27;s prototype</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123; <span class="comment">// the compiler looks for a type with the exact name promise_type inside the return type</span></span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// gets executed before a coroutine starts execution</span></span><br><span class="line">        <span class="function">std::suspend_never <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// gets executed when a coroutine finishes execution</span></span><br><span class="line">        <span class="function">ReturnType <span class="title">get_return_object</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> &#123;&#125;; &#125; <span class="comment">// this is the first method gets called when the coroutine is called for the first time</span></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SuspendAlways</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">await_ready</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;await_ready()\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">await_suspend</span><span class="params">( std::coroutine_handle&lt;&gt; )</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;await_suspend()\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">await_resume</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;await_resume()\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ReturnType <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;1 foo\n&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">SuspendAlways</span><span class="params">()</span></span>; <span class="comment">// suspend</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;2 foo\n&quot;</span>; <span class="comment">// will never execute since coroutine suspends in the above line</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ReturnType r = <span class="built_in">foo</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 foo</span><br><span class="line">await_ready()</span><br><span class="line">await_suspend()</span><br></pre></td></tr></table></figure>
<p>Since after the coroutine is suspended, we never resume it, so <code>await_resume</code> will not be called. Similarly, we can define a customized version of <code>std::suspend_never</code>. The main difference is that <code>await_ready()</code> should return <code>true</code> this time, and the coroutine will resume its execution.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Ld_s1GtLkr4&list=PL2EnPlznFzmhKDBfE0lqMAWyr74LZsFVY&index=2">https://www.youtube.com/watch?v=Ld_s1GtLkr4&amp;list=PL2EnPlznFzmhKDBfE0lqMAWyr74LZsFVY&amp;index=2</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/coroutine/coroutine_handle">https://en.cppreference.com/w/cpp/coroutine/coroutine_handle</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/coroutines#:~:text=%5Bedit%5D%20Restrictions,main%20function%20cannot%20be%20coroutines">https://en.cppreference.com/w/cpp/language/coroutines#:~:text=%5Bedit%5D%20Restrictions,main%20function%20cannot%20be%20coroutines</a>.</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Coroutine in C++</p><p><a href="http://chuzcjoe.github.io/cpp/cpp-coroutine/">http://chuzcjoe.github.io/cpp/cpp-coroutine/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Joe Chu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-04-07</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-10-15</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/cpp/">cpp</a><a class="link-muted mr-2" rel="tag" href="/tags/coroutine/">coroutine</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://chuzcjoe.github.io/" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="chuzcjoe@gmail.com"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/cpp/cpp-nodiscard/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">nodiscard in C++</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/life-marina-park/"><span class="level-item">Marina Park</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://chuzcjoe.github.io/cpp/cpp-coroutine/';
            this.page.identifier = 'cpp/cpp-coroutine/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'chuzcjoe-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/baby.png" alt="Joe Chu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Joe Chu</p><p class="is-size-6 is-block">I like to keep knowledge and memories visible and readable.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fremont, CA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">247</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">187</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/chuzcjoe" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/chuzcjoe"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/joe-chu-1784b3179/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Scholar" href="https://scholar.google.com/citations?user=DCwJ1qcAAAAJ&amp;hl=en"><i class="fab fa-google"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1486482663275315" data-ad-slot="5727003811" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-12T07:51:52.000Z">2025-10-12</time></p><p class="title"><a href="/CGV/cgv-camera-intrinsic-extrinsic/">Camera Intrinsic and Extrinsic</a></p><p class="categories"><a href="/categories/CGV/">CGV</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-10T05:33:34.000Z">2025-10-09</time></p><p class="title"><a href="/CGV/cgv-barycentric-rasterization/">Barycentric Rasterization</a></p><p class="categories"><a href="/categories/CGV/">CGV</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-06T05:43:08.000Z">2025-10-05</time></p><p class="title"><a href="/life/life-lemos-farm/">Lemos Farm</a></p><p class="categories"><a href="/categories/life/">life</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-04T05:06:46.000Z">2025-10-03</time></p><p class="title"><a href="/cpp/cpp-user-defined-types-as-hash-key/">User-defined Types as Hash Keys in C++</a></p><p class="categories"><a href="/categories/cpp/">cpp</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-09-21T04:01:52.000Z">2025-09-20</time></p><p class="title"><a href="/life/life-newark-day/">Newark Day</a></p><p class="categories"><a href="/categories/life/">life</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/"><span class="level-start"><span class="level-item">2025</span></span><span class="level-end"><span class="level-item tag">100</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">107</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/expert.png" alt="JoeChu" height="28"></a><p class="is-size-7"><span>&copy; 2025 Joe Chu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">uv <span id="busuanzi_value_site_uv">0</span></span><br><span id="busuanzi_container_site_pv">pv <span id="busuanzi_value_site_pv">0</span></span></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>